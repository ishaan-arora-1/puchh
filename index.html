<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title data-i18n="title">Aapka Stock</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="description" content="Live preview of your sheet with UI in regional languages." />
  <style>
    :root {
      --radius: 14px;
      --shadow: 0 16px 32px -4px rgba(0,0,0,0.08);
      --bg: #f5f7fa;
      --card: #ffffff;
      --fg: #1f2d3d;
      --muted: #64748b;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
    }
    *{box-sizing:border-box;}
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      line-height:1.4;
    }
    .container {
      padding: 1rem 1rem 2rem;
      max-width: 920px;
      margin: auto;
    }
    .topbar {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .title-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .title {
      margin: 0;
      font-size: 1.55rem;
      font-weight: 700;
      line-height:1.1;
    }
    .badge {
      display: inline-block;
      background: #e6ecff;
      color: #3747e0;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: .5px;
    }
    .selector {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: nowrap;
    }
    label {
      font-size: 0.85rem;
    }
    select {
      appearance: none;
      padding: 10px 14px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      background: #fff;
      min-width: 140px;
      cursor: pointer;
    }
    .description {
      margin: 0.75rem 0 1rem;
      font-size: 0.95rem;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 0.75rem 0.75rem 0.75rem 0.75rem;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: none;
      border-radius: 12px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }
    th, td {
      border: 1px solid #e2e8f0;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f1f5fb;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }
    .btn {
      padding: 8px 14px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #3b82f6;
      color: white;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .note {
      font-size: 0.65rem;
      color: #555;
      margin-top: 4px;
    }
    @media (max-width: 700px) {
      .title { font-size: 1.35rem; }
      iframe { height: 420px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="title-wrap">
        <h1 class="title" data-i18n="heading">Aapka Stock</h1>
        <div class="badge" data-i18n="subheading">Live Sheet Preview</div>
      </div>
      <div class="selector">
        <label for="lang" data-i18n="lang_label">Language:</label>
        <select id="lang" aria-label="Language selector">
          <option value="en">English</option>
          <option value="hi">рд╣рд┐рдиреНрджреА</option>
          <option value="bn">ржмрж╛ржВрж▓рж╛</option>
          <option value="te">р░др▒Жр░▓р▒Бр░Чр▒Б</option>
          <option value="mr">рдорд░рд╛рдареА</option>
          <option value="ta">родрооро┐ро┤рпН</option>
          <option value="gu">ркЧрлБркЬрк░рк╛ркдрлА</option>
          <option value="kn">р▓Хр▓ир│Нр▓ир▓б</option>
          <option value="or">рмУрмбрм╝рм┐рмЖ</option>
          <option value="pa">рикрй░риЬри╛римрйА</option>
          <option value="ml">р┤ор┤▓р┤пр┤╛р┤│р┤В</option>
        </select>
      </div>
    </div>

    <p class="description" data-i18n="description">
      This page shows the sheet; updates appear automatically in the embedded view.
    </p>

    <div class="card">
      <!-- embedded published-to-web sheet -->
      <iframe 
        id="sheet-embed"
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTnvcKAlOG8D_DMeRTbbiuPU9luWerwDM1rinrbaCwCCjemr69UhvPzgqTv5YMfZODkivYX-py9gpl1/pubhtml?widget=true&amp;headers=false"
        loading="lazy"
        title="Sheet Preview">
      </iframe>
    </div>

    <!-- Inventory Management Buttons -->
    <div class="card">
      <div class="table-header">
        <div>
          <h2 style="margin:0; font-size:1rem;" data-i18n="inventory_heading">Inventory Management</h2>
          <div class="note" data-i18n="inventory_sub">Check low stock and expiry alerts with WhatsApp notifications.</div>
        </div>
      </div>
      <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:12px;">
        <button id="run-all" class="btn" style="background: #000000; color: white; font-weight: bold; padding: 12px 20px;">
          <span data-i18n="run_all">ЁЯЪА RUN ALL FUNCTIONS</span>
        </button>
        <button id="check-inventory" class="btn" style="background: #10b981;">
          <span data-i18n="check_inventory">Check Inventory Alerts</span>
        </button>
        <button id="test-places" class="btn" style="background: #3b82f6;">
          <span data-i18n="test_places">Test Places API</span>
        </button>
        <button id="test-whatsapp" class="btn" style="background: #8b5cf6;">
          <span data-i18n="test_whatsapp">Test WhatsApp</span>
        </button>
        <button id="check-low-stock" class="btn" style="background: #f59e0b;">
          <span data-i18n="check_low_stock">Check Low Stock</span>
        </button>
        <button id="check-expiry" class="btn" style="background: #ef4444;">
          <span data-i18n="check_expiry">Check Expiry</span>
        </button>
      </div>
      <div id="inventory-status" style="margin-top:12px; padding:8px; border-radius:8px; background:#f8fafc; font-size:0.85rem; min-height:20px;">
        Ready to check inventory...
      </div>
    </div>

    <!-- translated table fallback -->
    <div class="card">
      <div class="table-header">
        <div>
          <h2 style="margin:0; font-size:1rem;" data-i18n="table_heading">Sheet (translated)</h2>
          <div class="note" data-i18n="table_sub">Fetched and machine-translated live.</div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <button id="refresh" class="btn"><span data-i18n="refresh">Refresh</span></button>
        </div>
      </div>
      <div id="table-container" style="overflow:auto;">Loading translated sheet...</div>
      <div class="note" data-i18n="translate_note">
        Translation is machine-generated; may take a moment and can be rate-limited.
      </div>
    </div>
  </div>

  <!-- Include excel.js script -->
  <script src="excel.js"></script>
  
  <script>
    // ---- configuration (replace placeholders) ----
    const SPREADSHEET_ID = "your-spreadsheet-id"; // e.g., the long ID from the sheet URL
    const RANGE = "Sheet1!A1:Z50"; // adjust if your sheet name or range differs
    const SHEETS_API_KEY = "YOUR_GOOGLE_API_KEY"; // create in Google Cloud and enable Sheets API
    const TRANSLATE_ENDPOINT = "https://libretranslate.de/translate"; // public LibreTranslate; swap if self-hosted
    
    // Get the API key from excel.js
    const API_KEY = window.API_KEY || "AIzaSyDBI8DPGF_i5vQ90U1OQgbbDvQBj1tW3Nw";
    
    console.log("ЁЯФС API Key loaded:", API_KEY ? "Available" : "Missing");
    console.log("ЁЯФС API Key preview:", API_KEY ? API_KEY.substring(0, 10) + "..." : "None");

    // ---- translations for UI ----
    const translations = {
      en: {
        title: "Aapka Stock",
        heading: "Aapka Stock",
        subheading: "Live Sheet Preview",
        lang_label: "Language:",
        description: "This page shows the sheet; updates appear automatically in the embedded view.",
        table_heading: "Sheet (translated)",
        table_sub: "Fetched and machine-translated live.",
        refresh: "Refresh",
        translate_note: "Translation is machine-generated; may take a moment and can be rate-limited.",
        inventory_heading: "Inventory Management",
        inventory_sub: "Check low stock and expiry alerts with WhatsApp notifications.",
        run_all: "ЁЯЪА RUN ALL FUNCTIONS",
        check_inventory: "Check Inventory Alerts",
        test_places: "Test Places API",
        test_whatsapp: "Test WhatsApp",
        check_low_stock: "Check Low Stock",
        check_expiry: "Check Expiry"
      },
      hi: {
        title: "рдЖрдкрдХрд╛ рд╕реНрдЯреЙрдХ",
        heading: "рдЖрдкрдХрд╛ рд╕реНрдЯреЙрдХ",
        subheading: "рд▓рд╛рдЗрд╡ рд╢реАрдЯ рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди",
        lang_label: "рднрд╛рд╖рд╛:",
        description: "рдпрд╣ рдкреЗрдЬ рд╢реАрдЯ рджрд┐рдЦрд╛рддрд╛ рд╣реИ; рдПрдореНрдмреЗрдб рдХрд┐рдП рдЧрдП рд╡реНрдпреВ рдореЗрдВ рдЕрдкрдбреЗрдЯ рдЕрдкрдиреЗ рдЖрдк рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред",
        table_heading: "рд╢реАрдЯ (рдЕрдиреБрд╡рд╛рджрд┐рдд)",
        table_sub: "рд▓рд╛рдЗрд╡ рд░реВрдк рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдФрд░ рдорд╢реАрди рд╕реЗ рдЕрдиреБрд╡рд╛рджрд┐рддред",
        refresh: "рддрд╛рдЬрд╝рд╛ рдХрд░реЗрдВ",
        translate_note: "рдЕрдиреБрд╡рд╛рдж рдорд╢реАрди рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ; рдЗрд╕рдореЗрдВ рдХреБрдЫ рд╕рдордп рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕реАрдорд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИред"
      },
      bn: {
        title: "ржЖржкржирж╛рж░ рж╕рзНржЯржХ",
        heading: "ржЖржкржирж╛рж░ рж╕рзНржЯржХ",
        subheading: "рж▓рж╛ржЗржн рж╢рзАржЯ ржкрзНрж░рж┐ржнрж┐ржЙ",
        lang_label: "ржнрж╛рж╖рж╛:",
        description: "ржПржЗ ржкрж╛рждрж╛ рж╢рзАржЯ ржжрзЗржЦрж╛ржпрж╝; ржЕржирзНрждрж░рзНржнрзБржХрзНржд ржнрж┐ржЙ-рждрзЗ ржЖржкржбрзЗржЯ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржкрзНрж░рждрж┐ржлрж▓рж┐ржд рж╣ржпрж╝ред",
        table_heading: "рж╢рзАржЯ (ржЕржирзБржмрж╛ржжрж┐ржд)",
        table_sub: "рж▓рж╛ржЗржнржнрж╛ржмрзЗ ржлрзЗржЪ ржХрж░рж╛ ржПржмржВ ржорзЗрж╢рж┐ржи ржЯрзНрж░рж╛ржирзНрж╕рж▓рзЗржЯрзЗржбред",
        refresh: "рждрж╛ржЬрж╛ ржХрж░рзБржи",
        translate_note: "ржЕржирзБржмрж╛ржж ржорзЗрж╢рж┐ржи-ржЬрзЗржирж╛рж░рзЗржЯрзЗржб; ржХрж┐ржЫрзБржХрзНрж╖ржг рж╕ржорзЯ рж▓рж╛ржЧрждрзЗ ржкрж╛рж░рзЗ ржПржмржВ рж╕рзАржорж┐ржд рж╣рждрзЗ ржкрж╛рж░рзЗред"
      },
      te: {
        title: "р░ор▒А р░╕р▒Нр░Яр░╛р░Хр▒Н",
        heading: "р░ор▒А р░╕р▒Нр░Яр░╛р░Хр▒Н",
        subheading: "р░╕р░Ьр▒Ар░╡ р░╖р▒Ар░Яр▒Н р░кр▒Нр░░р░┐р░╡р▒Нр░пр▒В",
        lang_label: "р░нр░╛р░╖:",
        description: "р░И р░кр▒Зр░Ьр▒А р░╖р▒Ар░Яр▒НтАМр░ир▒Б р░Ър▒Вр░кр░┐р░╕р▒Нр░др▒Бр░Вр░жр░┐; р░Ор░Вр░мр▒Жр░бр▒Н р░Ър▒Зр░╕р░┐р░и р░╡р▒Ар░╡р▒Бр░▓р▒Л р░ир░╡р▒Ар░Хр░░р░гр░▓р▒Б р░Жр░Яр▒Лр░ор▒Зр░Яр░┐р░Хр▒НтАМр░Чр░╛ р░Хр░ир░┐р░кр░┐р░╕р▒Нр░др░╛р░пр░┐.",
        table_heading: "р░╖р▒Ар░Яр▒Н (р░Ер░ир▒Бр░╡р░жр░┐р░Вр░Ър░мр░бр░┐р░Вр░жр░┐)",
        table_sub: "р░Ьр▒Ар░╡р░Вр░Чр░╛ р░лр▒Жр░Ър▒Н р░Ър▒Зр░пр░мр░бр░┐р░Вр░жр░┐ р░ор░░р░┐р░пр▒Б р░ор▒Жр░╖р▒Ар░ир▒Н р░Ер░ир▒Бр░╡р░жр░┐р░Вр░Ър░┐р░Вр░жр░┐.",
        refresh: "р░░р░┐р░лр▒Нр░░р▒Жр░╖р▒Н р░Ър▒Зр░пр░Вр░бр░┐",
        translate_note: "р░Ер░ир▒Бр░╡р░╛р░жр░В р░ор▒Жр░╖р▒Ар░ир▒Н р░жр▒Нр░╡р░╛р░░р░╛ р░Ър▒Зр░пр░мр░бр░┐р░Вр░жр░┐; р░Хр▒Кр░жр▒Нр░жр░┐р░Чр░╛ р░╕р░ор░пр░В р░кр░бр░╡р░Ър▒Нр░Ър▒Б р░ор░░р░┐р░пр▒Б р░кр░░р░┐р░ор░┐р░др░┐ р░Йр░Вр░бр░╡р░Ър▒Нр░Ър▒Б."
      },
      mr: {
        title: "рдЖрдкрд▓рд╛ рд╕реНрдЯреЙрдХ",
        heading: "рдЖрдкрд▓рд╛ рд╕реНрдЯреЙрдХ",
        subheading: "рдЭрд┐рд╡рдВрдд рд╢реАрдЯ рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди",
        lang_label: "рднрд╛рд╖рд╛:",
        description: "рд╣рд╛ рдкреГрд╖реНрда рд╢реАрдЯ рджрд╛рдЦрд╡рддреЛ; рдПрдореНрдмреЗрдб рдХреЗрд▓реЗрд▓реНрдпрд╛ рджреГрд╢реНрдпрд╛рдд рдЕрджреНрдпрддрдиреЗ рдЖрдкреЛрдЖрдк рджрд┐рд╕рддрд╛рдд.",
        table_heading: "рд╢реАрдЯ (рдЕрдиреБрд╡рд╛рджрд┐рдд)",
        table_sub: "рд▓рд╛рдЗрд╡реНрд╣ рдлреЗрдЪ рдХреЗрд▓реЗрд▓реЗ рдЖрдгрд┐ рдорд╢реАрдирдиреЗ рдЕрдиреБрд╡рд╛рдж рдХреЗрд▓реЗрд▓реЗ.",
        refresh: "рдкреБрдиреНрд╣рд╛ рддрд╛рдЬреЗрддрд╡рд╛рдиреЗ рдХрд░рд╛",
        translate_note: "рдЕрдиреБрд╡рд╛рдж рдорд╢реАрдирджреНрд╡рд╛рд░реЗ рдХрд░рдгреНрдпрд╛рдд рдЖрд▓рд╛ рдЖрд╣реЗ; рдереЛрдбрд╛ рд╡реЗрд│ рд▓рд╛рдЧреВ рд╢рдХрддреЛ рдЖрдгрд┐ рдорд░реНрдпрд╛рджрд╛ рдЕрд╕реВ рд╢рдХрддрд╛рдд."
      },
      ta: {
        title: "роЙроЩрпНроХро│рпН ро╕рпНроЯро╛роХрпН",
        heading: "роЙроЩрпНроХро│рпН ро╕рпНроЯро╛роХрпН",
        subheading: "роирпЗро░роЯро┐ ро╖рпАроЯрпН роорпБройрпНройрпЛроЯрпНроЯроорпН",
        lang_label: "роорпКро┤ро┐:",
        description: "роЗроирпНрод рокроХрпНроХроорпН ро╖рпАроЯрпНроЯрпИ роХро╛роЯрпНроЯрпБроХро┐ро▒родрпБ; роПроорпНрокрпЖроЯрпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯ роХро╛роЯрпНроЪро┐ропро┐ро▓рпН роорпЗроорпНрокро╛роЯрпБроХро│рпН родро╛ройро╛роХ родрпЖро░ро┐ропрпБроорпН.",
        table_heading: "ро╖рпАроЯрпН (роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ)",
        table_sub: "роирпЗро░роЯро┐ропро╛роХ рокрпЖро▒рокрпНрокроЯрпНроЯ рооро▒рпНро▒рпБроорпН роорпЖро╖ро┐ройрпН роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ.",
        refresh: "рокрпБродрпБрокрпНрокро┐роХрпНроХ",
        translate_note: "роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роорпЖро╖ро┐ройрпН роЙро░рпБро╡ро╛роХрпНроХро┐ропродрпБ; роЪро┐ро▓ роирпЗро░роорпН роОроЯрпБроХрпНроХро▓ро╛роорпН рооро▒рпНро▒рпБроорпН ро╡ро░роорпНрокрпБ роЗро░рпБроХрпНроХро▓ро╛роорпН."
      },
      gu: {
        title: "ркдркорк╛рк░рлБркВ рк╕рлНркЯрлЛркХ",
        heading: "ркдркорк╛рк░рлБркВ рк╕рлНркЯрлЛркХ",
        subheading: "рк▓рк╛ркЗрк╡ рк╢рлАркЯ рккрлВрк░рлНрк╡рк╛рк╡рк▓рлЛркХрки",
        lang_label: "ркнрк╛рк╖рк╛:",
        description: "ркЖ рккрлЗркЬ рк╢рлАркЯ ркмркдрк╛рк╡рлЗ ркЫрлЗ; ркПркорлНркмрлЗркб ркХрк░рк╡рк╛ркорк╛ркВ ркЖрк╡рлЗрк▓рк╛ рк╡рлНркпрлВркорк╛ркВ ркЕрккркбрлЗркЯрлНрк╕ ркЖрккркорлЗрк│рлЗ ркжрлЗркЦрк╛ркп ркЫрлЗ.",
        table_heading: "рк╢рлАркЯ (ркЕркиuvadрк┐ркд)",
        table_sub: "рк▓рк╛ркЗрк╡ рк░рлАркдрлЗ рк▓рк╛ркИ ркЧркпрлЗрк▓ ркЕркирлЗ ркорк╢рлАркиркерлА ркЕркирлБрк╡рк╛ркжрк┐ркд.",
        refresh: "рк░рлАрклрлНрк░рлЗрк╢ ркХрк░рлЛ",
        translate_note: "ркЕркирлБрк╡рк╛ркж ркорк╢рлАрки ркжрлНрк╡рк╛рк░рк╛ ркмркирк╛рк╡рк╛ркпрлЗрк▓рлЛ ркЫрлЗ; ркерлЛркбрлЛ рк╕ркоркп рк▓рк╛ркЧрлА рк╢ркХрлЗ ркЫрлЗ ркЕркирлЗ ркорк░рлНркпрк╛ркжрк┐ркд ркеркИ рк╢ркХрлЗ ркЫрлЗ."
      },
      kn: {
        title: "р▓ир▓┐р▓ор│Нр▓о р▓╕р│Нр▓Яр▓╛р▓Хр│Н",
        heading: "р▓ир▓┐р▓ор│Нр▓о р▓╕р│Нр▓Яр▓╛р▓Хр│Н",
        subheading: "р▓Ьр│Ир▓╡ р▓╢р│Ар▓Яр│Н р▓кр│Вр▓░р│Нр▓╡р▓жр│Гр▓╢р│Нр▓п",
        lang_label: "р▓нр▓╛р▓╖р│Ж:",
        description: "р▓И р▓кр│Бр▓Яр▓╡р│Б р▓╢р│Ар▓Яр│Н р▓Ер▓ир│Нр▓ир│Б р▓др│Лр▓░р▓┐р▓╕р│Бр▓др│Нр▓др▓жр│Ж; р▓Ор▓Вр▓мр│Жр▓бр│Н р▓ор▓╛р▓бр▓┐р▓ж р▓╡р│Ар▓Хр│Нр▓╖р▓гр│Жр▓пр▓▓р│Нр▓▓р▓┐ р▓ир▓╡р│Ар▓Хр▓░р▓гр▓Чр▓│р│Б р▓╕р│Нр▓╡р▓пр▓Вр▓Ър▓╛р▓▓р▓┐р▓др▓╡р▓╛р▓Чр▓┐ р▓Хр▓╛р▓гр▓┐р▓╕р│Бр▓др│Нр▓др▓╡р│Ж.",
        table_heading: "р▓╢р│Ар▓Яр│Н (р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓┐р▓╕р▓▓р▓╛р▓Чр▓┐р▓жр│Ж)",
        table_sub: "р▓▓р│Ир▓╡р│НтАМр▓ир▓▓р│Нр▓▓р▓┐ р▓лр│Жр▓Ър│Н р▓ор▓╛р▓бр▓▓р▓╛р▓Чр▓┐р▓жр│Ж р▓ор▓др│Нр▓др│Б р▓пр▓Вр▓др│Нр▓░р▓жр▓┐р▓Вр▓ж р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓┐р▓╕р▓▓р▓╛р▓Чр▓┐р▓жр│Ж.",
        refresh: "р▓ир▓╡р│Ар▓Хр▓░р▓┐р▓╕р▓┐",
        translate_note: "р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓╡р▓ир│Нр▓ир│Б р▓пр▓Вр▓др│Нр▓░р▓╡р│Б р▓░р▓Ър▓┐р▓╕р▓┐р▓жр│Ж; р▓╕р│Нр▓╡р▓▓р│Нр▓к р▓╕р▓ор▓п р▓др│Жр▓Чр│Жр▓жр│Бр▓Хр│Кр▓│р│Нр▓│р▓мр▓╣р│Бр▓жр│Б р▓ор▓др│Нр▓др│Б р▓ор▓┐р▓др▓┐р▓пр▓▓р│Нр▓▓р▓┐р▓░р▓мр▓╣р│Бр▓жр│Б."
      },
      or: {
        title: "рмЖрмкрмгрмЩрнНрмХрм░ рм╖рнНрмЯрмХрнН",
        heading: "рмЖрмкрмгрмЩрнНрмХрм░ рм╖рнНрмЯрмХрнН",
        subheading: "рм╕рмЬрнАрмм рм╢рм┐рмЯрнН рмкрнВрм░рнНрммрмжрнГрм╢рнНрнЯ",
        lang_label: "рмнрм╛рм╖рм╛:",
        description: "рмПрм╣рм┐ рмкрнГрм╖рнНрмарм╛ рм╢рм┐рмЯрнН рмжрм░рнНрм╢рм╛рмП; рмПрморнНрммрнЗрмбрнН рм╣рнЛрмЗрмерм┐рммрм╛ рмнрнНрнЯрнБрм░рнЗ рмЕрмжрнНрнЯрмдрми рмЖрмкрнЛрмЖрмкрм┐ рмкрнНрм░рмжрм░рнНрм╢рм┐рмд рм╣рнБрмПред",
        table_heading: "рм╢рм┐рмЯрнН (рмЕрмирнБрммрм╛рмжрм┐рмд)",
        table_sub: "рм╕рмЬрнАрмм рмнрм╛рммрм░рнЗ рмлрнЗрмЪрнН рм╣рнЛрмЗрмЫрм┐ рмПрммрмВ рморнЗрм╕рм┐рмирнН рмжрнНрн▒рм╛рм░рм╛ рмЕрмирнБрммрм╛рмжрм┐рмдред",
        refresh: "рмдрм╛рмЬрм╛ рмХрм░рмирнНрмдрнБ",
        translate_note: "рмЕрмирнБрммрм╛рмж рморнЗрм╕рм┐рмирнН рмжрнНрн▒рм╛рм░рм╛ рмдрм┐рмЖрм░рм┐; рмХрм┐рмЫрм┐ рм╕рморнЯ рм▓рм╛рмЧрм┐рмкрм╛рм░рнЗ рмПрммрмВ рм╕рнАрморм┐рмд рм╣рнЛрмЗрмкрм╛рм░рнЗред"
      },
      pa: {
        title: "ридрйБри╣ри╛рибри╛ ри╕риЯри╛риХ",
        heading: "ридрйБри╣ри╛рибри╛ ри╕риЯри╛риХ",
        subheading: "ри▓ри╛риИри╡ ри╕рйАриЯ рикрйНри░рйАри╡ри┐риК",
        lang_label: "ринри╛ри╕ри╝ри╛:",
        description: "риЗри╣ рикрй░риири╛ ри╕рйАриЯ рижри┐риЦри╛риЙриВрижри╛ ри╣рйИ; риПрй░римрйИриб риХрйАридрйЗ рижрйНри░ри┐ри╕ри╝ ри╡ри┐рй▒риЪ риЕрикрибрйЗриЯ риЖриЯрйЛриорйИриЯри┐риХ ридрйМри░ 'ридрйЗ рижри┐риЦри╛риИ рижрйЗ ри░ри╣рйЗ ри╣рииред",
        table_heading: "ри╕рйАриЯ (риЕриирйБри╡ри╛рижри┐рид)",
        table_sub: "ри▓ри╛риИри╡ ридрйМри░ 'ридрйЗ рилрйИриЪ риХрйАридрйА риЧриИ риЕридрйЗ риори╕ри╝рйАрии рижрйБриЖри░ри╛ риЕриирйБри╡ри╛риж риХрйАридрйА риЧриИред",
        refresh: "ридри╛риЬри╝ри╛ риХри░рйЛ",
        translate_note: "риЕриирйБри╡ри╛риж риори╕ри╝рйАрии-риЬриири░рйЗриЯри┐риб ри╣рйИ; риХрйБриЭ ри╕риори╛риВ ри▓рй▒риЧ ри╕риХрижри╛ ри╣рйИ риЕридрйЗ ри╕рйАриори┐рид ри╣рйЛ ри╕риХрижри╛ ри╣рйИред"
      },
      ml: {
        title: "р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤╕р╡Нр┤▒р╡Нр┤▒р╡Лр┤Хр╡Нр┤Хр╡Н",
        heading: "р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤╕р╡Нр┤▒р╡Нр┤▒р╡Лр┤Хр╡Нр┤Хр╡Н",
        subheading: "р┤▓р╡Ир┤╡р╡Н р┤╖р╡Ар┤▒р╡Нр┤▒р╡Н р┤ор╡Бр╡╗р┤Хр╡Вр╡╝ р┤жр╡Гр┤╢р╡Нр┤пр┤В",
        lang_label: "р┤нр┤╛р┤╖:",
        description: "р┤И р┤кр╡Зр┤Ьр╡Н р┤╖р╡Ар┤▒р╡Нр┤▒р╡Н р┤Хр┤╛р┤гр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б; р┤Ор┤ор╡Нр┤кр╡Жр┤бр╡Н р┤Ър╡Жр┤пр╡Нр┤д р┤жр╡Гр┤╢р╡Нр┤пр┤др╡Нр┤др┤┐р╡╜ р┤Ер┤кр╡Нр┤бр╡Зр┤▒р╡Нр┤▒р╡Бр┤Хр╡╛ р┤╕р╡Нр┤╡р┤пр┤В р┤кр╡Нр┤░р┤др┤┐р┤лр┤▓р┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б.",
        table_heading: "р┤╖р╡Ар┤▒р╡Нр┤▒р╡Н (р┤др╡╝р┤Ьр╡Нр┤о р┤Ър╡Жр┤пр╡Нр┤др┤┐р┤░р┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б)",
        table_sub: "р┤▓р╡Ир┤╡р╡Н р┤Жр┤пр┤┐ р┤лр╡Жр┤Ър╡Нр┤Ър╡Н р┤Ър╡Жр┤пр╡Нр┤др╡Н р┤ор╡Жр┤╖р╡Ар╡╗ р┤Яр╡Нр┤░р┤╛р╡╗р┤╕р╡НтАМр┤▓р╡Зр┤▒р╡Нр┤▒р╡Н р┤Ър╡Жр┤пр╡Нр┤др┤др╡Н.",
        refresh: "р┤кр┤░р╡Бр┤др╡Нр┤др┤┐р┤Хр╡Нр┤Хр╡Бр┤Х",
        translate_note: "р┤др╡╝р┤Ьр╡Нр┤ор┤╛р┤╡р╡Н р┤ор╡Жр┤╖р╡Ар╡╗ р┤ир┤┐р╡╝р┤ор╡Нр┤ор┤┐р┤др┤ор┤╛р┤гр╡Н; р┤Хр╡Бр┤▒р┤Ър╡Нр┤Ър╡Н р┤╕р┤ор┤пр┤В р┤Ор┤Яр╡Бр┤Хр╡Нр┤Хр┤╛р┤В, р┤кр┤░р┤┐р┤зр┤┐ р┤Йр┤гр╡Нр┤Яр┤╛р┤Хр┤╛р┤В."
      }
    };

    // mapping (LibreTranslate uses same codes for these)
    const langMap = {
      en: "en",
      hi: "hi",
      bn: "bn",
      te: "te",
      mr: "mr",
      ta: "ta",
      gu: "gu",
      kn: "kn",
      or: "or",
      pa: "pa",
      ml: "ml"
    };

    let originalValues = null;

    async function fetchSheet() {
      // uses Sheets API; for public sheet you need an API key with Sheets API enabled.
      const url = `https://sheets.googleapis.com/v4/spreadsheets/1MussZ5RJ6yblFHQ6f-XyLsm6-_RHRBeLV7dr3NA66UU/values/Sheet1?key=AIzaSyDBI8DPGF_i5vQ90U1OQgbbDvQBj1tW3Nw`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Sheet fetch failed: " + res.statusText);
      const data = await res.json();
      return data.values || [];
    }

    async function translateText(text, targetLang) {
      if (!text) return "";
      if (targetLang === "en") return text;
      try {
        const resp = await fetch(TRANSLATE_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            q: text,
            source: "auto",
            target: targetLang,
            format: "text"
          })
        });
        const j = await resp.json();
        return j.translatedText || text;
      } catch (e) {
        console.warn("translate error", e);
        return text;
      }
    }

    async function renderTranslated(lang) {
      const target = langMap[lang] || "en";
      const container = document.getElementById("table-container");
      container.textContent = (translations[lang]?.table_sub) || "Translating...";
      if (!originalValues) {
        try {
          originalValues = await fetchSheet();
        } catch (e) {
          container.textContent = "Error fetching sheet: " + e.message;
          return;
        }
      }
      // translate every cell sequentially (could be optimized/batched)
      const translatedRows = [];
      for (let i = 0; i < originalValues.length; i++) {
        const row = originalValues[i];
        const translatedRow = await Promise.all(
          row.map(cell => translateText(cell, target))
        );
        translatedRows.push(translatedRow);
      }

      // build table
      const table = document.createElement("table");
      // header
      const headerRow = document.createElement("tr");
      (translatedRows[0] || []).forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);
      // body
      for (let i = 1; i < translatedRows.length; i++) {
        const tr = document.createElement("tr");
        translatedRows[i].forEach(c => {
          const td = document.createElement("td");
          td.textContent = c;
          tr.appendChild(td);
        });
        table.appendChild(tr);
      }

      container.innerHTML = "";
      container.appendChild(table);
    }

    function applyLang(lang) {
      const dict = translations[lang] || translations.en;
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (!dict[key]) return;
        if (el.tagName.toLowerCase() === "title") {
          document.title = dict[key];
        }
        el.textContent = dict[key];
      });
      localStorage.setItem("lang", lang);
      document.getElementById("lang").value = lang;
      // trigger translated sheet update
      renderTranslated(lang);
    }

    function initLang() {
      const params = new URLSearchParams(window.location.search);
      let lang = params.get("lang") || localStorage.getItem("lang") || (navigator.language || "en").slice(0,2);
      if (!Object.keys(langMap).includes(lang)) lang = "en";
      applyLang(lang);
    }

    document.getElementById("lang").addEventListener("change", e => {
      applyLang(e.target.value);
      const u = new URL(window.location);
      u.searchParams.set("lang", e.target.value);
      history.replaceState(null, "", u);
    });

    document.getElementById("refresh").addEventListener("click", () => {
      originalValues = null;
      const lang = document.getElementById("lang").value;
      renderTranslated(lang);
    });

    // initialize on load
    initLang();

    // ========================================
    // INVENTORY MANAGEMENT BUTTON HANDLERS
    // ========================================

    // Function to update status
    function updateInventoryStatus(message, isError = false) {
      const statusDiv = document.getElementById('inventory-status');
      statusDiv.textContent = message;
      statusDiv.style.background = isError ? '#fef2f2' : '#f0fdf4';
      statusDiv.style.color = isError ? '#dc2626' : '#166534';
    }

    // Run All Functions (like running excel.js)
    document.getElementById('run-all').addEventListener('click', async () => {
      try {
        console.log("\n" + "ЁЯЪА".repeat(20));
        console.log("STARTING AUTOMATIC FUNCTION EXECUTION");
        console.log("ЁЯЪА".repeat(20));

        // 1. Test Places API first
        updateInventoryStatus('ЁЯзк Testing Places API...');
        console.log("\n" + "=".repeat(60));
        console.log("ЁЯзк TESTING PLACES API");
        console.log("=".repeat(60));
        console.log('ЁЯФС Using API Key:', API_KEY ? API_KEY.substring(0, 10) + "..." : "None");
        const places = await testPlacesAPI(API_KEY);
        if (places) {
          const totalPlaces = places.gurudwaras.length + places.mandirs.length + places.ngos.length;
          updateInventoryStatus(`тЬЕ Places API test successful! Found ${totalPlaces} places total.`);
          console.log('ЁЯУК Places found:', {
            gurudwaras: places.gurudwaras.length,
            mandirs: places.mandirs.length,
            ngos: places.ngos.length
          });
        } else {
          updateInventoryStatus('тЭМ Places API test failed.', true);
        }
        
        // Wait a moment between tests
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 2. Test WhatsApp messaging with places
        updateInventoryStatus('ЁЯзк Testing WhatsApp messaging with places...');
        console.log("\n" + "=".repeat(60));
        console.log("ЁЯзк TESTING WHATSAPP MESSAGING WITH PLACES");
        console.log("=".repeat(60));
        await testExpiryWithPlaces(30);
        updateInventoryStatus('тЬЕ WhatsApp test message sent successfully!');
        
        // Wait a moment between tests
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 3. Run comprehensive inventory check
        updateInventoryStatus('ЁЯУК Running comprehensive inventory check...');
        console.log("\n" + "=".repeat(60));
        console.log("ЁЯУК RUNNING COMPREHENSIVE INVENTORY CHECK");
        console.log("=".repeat(60));
        const result = await checkInventoryAlerts(5, 30);
        
        console.log("\n" + "тЬЕ".repeat(20));
        console.log("ALL FUNCTIONS COMPLETED SUCCESSFULLY!");
        console.log("тЬЕ".repeat(20));
        
        updateInventoryStatus(`тЬЕ ALL FUNCTIONS COMPLETED! Found ${result.lowStock.length} low stock and ${result.expiring.length} expiring products.`);
        
      } catch (error) {
        console.error("\nтЭМ Error in automatic execution:", error);
        updateInventoryStatus(`тЭМ Error: ${error.message}`, true);
      }
    });

    // Check Inventory Alerts (Comprehensive)
    document.getElementById('check-inventory').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Checking inventory alerts...');
        console.log('ЁЯЪА Starting comprehensive inventory check...');
        
        const result = await checkInventoryAlerts(5, 30);
        
        updateInventoryStatus(`тЬЕ Inventory check completed! Found ${result.lowStock.length} low stock and ${result.expiring.length} expiring products.`);
        
        console.log('ЁЯУК Inventory check results:', result);
      } catch (error) {
        console.error('тЭМ Error in inventory check:', error);
        updateInventoryStatus(`тЭМ Error: ${error.message}`, true);
      }
    });

    // Test Places API
    document.getElementById('test-places').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Testing Places API...');
        console.log('ЁЯзк Testing Places API...');
        console.log('ЁЯФС Using API Key:', API_KEY ? API_KEY.substring(0, 10) + "..." : "None");
        
        // First test if we can access the Places API directly
        const testUrl = `https://maps.googleapis.com/maps/api/place/textsearch/json?query=gurudwara&location=28.4089,77.3178&radius=5000&key=${API_KEY}`;
        console.log('ЁЯМР Testing direct API access...');
        
        try {
          const testResponse = await fetch(testUrl);
          console.log('ЁЯУб API Response status:', testResponse.status);
          const testData = await testResponse.json();
          console.log('ЁЯУб API Response data:', testData);
          
          if (testData.status === 'REQUEST_DENIED') {
            updateInventoryStatus('тЭМ API Key is invalid or has restrictions', true);
            return;
          }
        } catch (apiError) {
          console.error('тЭМ Direct API test failed:', apiError);
          updateInventoryStatus('тЭМ Cannot access Places API (CORS issue)', true);
          return;
        }
        
        const places = await testPlacesAPI(API_KEY);
        
        if (places) {
          const totalPlaces = places.gurudwaras.length + places.mandirs.length + places.ngos.length;
          updateInventoryStatus(`тЬЕ Places API test successful! Found ${totalPlaces} places total.`);
          console.log('ЁЯУК Places found:', {
            gurudwaras: places.gurudwaras.length,
            mandirs: places.mandirs.length,
            ngos: places.ngos.length
          });
        } else {
          updateInventoryStatus('тЭМ Places API test failed.', true);
        }
      } catch (error) {
        console.error('тЭМ Error testing Places API:', error);
        updateInventoryStatus(`тЭМ Error: ${error.message}`, true);
      }
    });

    // Test WhatsApp Messaging
    document.getElementById('test-whatsapp').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Testing WhatsApp messaging...');
        console.log('ЁЯУ▒ Testing WhatsApp messaging...');
        
        await testExpiryWithPlaces(30);
        
        updateInventoryStatus('тЬЕ WhatsApp test message sent successfully!');
      } catch (error) {
        console.error('тЭМ Error testing WhatsApp:', error);
        updateInventoryStatus(`тЭМ Error: ${error.message}`, true);
      }
    });

    // Check Low Stock Only
    document.getElementById('check-low-stock').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Checking low stock products...');
        console.log('ЁЯУж Checking low stock products...');
        
        const lowStockProducts = await triggerLowStockCheck(5);
        
        updateInventoryStatus(`тЬЕ Low stock check completed! Found ${lowStockProducts.length} products with low stock.`);
      } catch (error) {
        console.error('тЭМ Error checking low stock:', error);
        updateInventoryStatus(`тЭМ Error: ${error.message}`, true);
      }
    });

    // Check Expiry Only
    document.getElementById('check-expiry').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Checking expiring products...');
        console.log('ЁЯУЕ Checking expiring products...');
        
        const expiringProducts = await triggerExpiryCheck(30);
        
        updateInventoryStatus(`тЬЕ Expiry check completed! Found ${expiringProducts.length} products nearing expiry.`);
      } catch (error) {
        console.error('тЭМ Error checking expiry:', error);
        updateInventoryStatus(`тЭМ Error: ${error.message}`, true);
      }
    });
  </script>
</body>
</html>
