<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title data-i18n="title">Aapka Stock</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="description" content="Live preview of your sheet with UI in regional languages." />
  <style>
    :root {
      --radius: 14px;
      --shadow: 0 16px 32px -4px rgba(0,0,0,0.08);
      --bg: #f5f7fa;
      --card: #ffffff;
      --fg: #1f2d3d;
      --muted: #64748b;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
    }
    *{box-sizing:border-box;}
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      line-height:1.4;
    }
    .container {
      padding: 1rem 1rem 2rem;
      max-width: 920px;
      margin: auto;
    }
    .topbar {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .title-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .title {
      margin: 0;
      font-size: 1.55rem;
      font-weight: 700;
      line-height:1.1;
    }
    .badge {
      display: inline-block;
      background: #e6ecff;
      color: #3747e0;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: .5px;
    }
    .selector {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: nowrap;
    }
    label {
      font-size: 0.85rem;
    }
    select {
      appearance: none;
      padding: 10px 14px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      background: #fff;
      min-width: 140px;
      cursor: pointer;
    }
    .description {
      margin: 0.75rem 0 1rem;
      font-size: 0.95rem;
    }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 0.75rem 0.75rem 0.75rem 0.75rem;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: none;
      border-radius: 12px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }
    th, td {
      border: 1px solid #e2e8f0;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f1f5fb;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }
    .btn {
      padding: 8px 14px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #3b82f6;
      color: white;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .note {
      font-size: 0.65rem;
      color: #555;
      margin-top: 4px;
    }
    @media (max-width: 700px) {
      .title { font-size: 1.35rem; }
      iframe { height: 420px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="title-wrap">
        <h1 class="title" data-i18n="heading">Aapka Stock</h1>
        <div class="badge" data-i18n="subheading">Live Sheet Preview</div>
      </div>
      <div class="selector">
        <label for="lang" data-i18n="lang_label">Language:</label>
        <select id="lang" aria-label="Language selector">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
          <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
          <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
          <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
          <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
          <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
          <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
          <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
        </select>
      </div>
    </div>

    <p class="description" data-i18n="description">
      This page shows the sheet; updates appear automatically in the embedded view.
    </p>

    <div class="card">
      <!-- embedded published-to-web sheet -->
      <iframe 
        id="sheet-embed"
        src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTnvcKAlOG8D_DMeRTbbiuPU9luWerwDM1rinrbaCwCCjemr69UhvPzgqTv5YMfZODkivYX-py9gpl1/pubhtml?widget=true&amp;headers=false"
        loading="lazy"
        title="Sheet Preview">
      </iframe>
    </div>

    <!-- Inventory Management Buttons -->
    <div class="card">
      <div class="table-header">
        <div>
          <h2 style="margin:0; font-size:1rem;" data-i18n="inventory_heading">Inventory Management</h2>
          <div class="note" data-i18n="inventory_sub">Check low stock and expiry alerts with WhatsApp notifications.</div>
        </div>
      </div>
      <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:12px;">
        <button id="run-all" class="btn" style="background: #000000; color: white; font-weight: bold; padding: 12px 20px;">
          <span data-i18n="run_all">üöÄ RUN ALL FUNCTIONS</span>
        </button>
        <button id="check-inventory" class="btn" style="background: #10b981;">
          <span data-i18n="check_inventory">Check Inventory Alerts</span>
        </button>
        <button id="test-places" class="btn" style="background: #3b82f6;">
          <span data-i18n="test_places">Test Places API</span>
        </button>
        <button id="test-whatsapp" class="btn" style="background: #8b5cf6;">
          <span data-i18n="test_whatsapp">Test WhatsApp</span>
        </button>
        <button id="check-low-stock" class="btn" style="background: #f59e0b;">
          <span data-i18n="check_low_stock">Check Low Stock</span>
        </button>
        <button id="check-expiry" class="btn" style="background: #ef4444;">
          <span data-i18n="check_expiry">Check Expiry</span>
        </button>
      </div>
      <div id="inventory-status" style="margin-top:12px; padding:8px; border-radius:8px; background:#f8fafc; font-size:0.85rem; min-height:20px;">
        Ready to check inventory...
      </div>
    </div>

    <!-- translated table fallback -->
    <div class="card">
      <div class="table-header">
        <div>
          <h2 style="margin:0; font-size:1rem;" data-i18n="table_heading">Sheet (translated)</h2>
          <div class="note" data-i18n="table_sub">Fetched and machine-translated live.</div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <button id="refresh" class="btn"><span data-i18n="refresh">Refresh</span></button>
        </div>
      </div>
      <div id="table-container" style="overflow:auto;">Loading translated sheet...</div>
      <div class="note" data-i18n="translate_note">
        Translation is machine-generated; may take a moment and can be rate-limited.
      </div>
    </div>
  </div>

  <!-- Include excel.js script -->
  <script src="excel.js"></script>
  
  <script>
    // ---- configuration (replace placeholders) ----
    const SPREADSHEET_ID = "your-spreadsheet-id"; // e.g., the long ID from the sheet URL
    const RANGE = "Sheet1!A1:Z50"; // adjust if your sheet name or range differs
    const SHEETS_API_KEY = "YOUR_GOOGLE_API_KEY"; // create in Google Cloud and enable Sheets API
    const TRANSLATE_ENDPOINT = "https://libretranslate.de/translate"; // public LibreTranslate; swap if self-hosted
    
    // Get the API key from excel.js
    const API_KEY = window.API_KEY || "AIzaSyDBI8DPGF_i5vQ90U1OQgbbDvQBj1tW3Nw";
    
    console.log("üîë API Key loaded:", API_KEY ? "Available" : "Missing");
    console.log("üîë API Key preview:", API_KEY ? API_KEY.substring(0, 10) + "..." : "None");

    // ---- translations for UI ----
    const translations = {
      en: {
        title: "Aapka Stock",
        heading: "Aapka Stock",
        subheading: "Live Sheet Preview",
        lang_label: "Language:",
        description: "This page shows the sheet; updates appear automatically in the embedded view.",
        table_heading: "Sheet (translated)",
        table_sub: "Fetched and machine-translated live.",
        refresh: "Refresh",
        translate_note: "Translation is machine-generated; may take a moment and can be rate-limited.",
        inventory_heading: "Inventory Management",
        inventory_sub: "Check low stock and expiry alerts with WhatsApp notifications.",
        run_all: "üöÄ RUN ALL FUNCTIONS",
        check_inventory: "Check Inventory Alerts",
        test_places: "Test Places API",
        test_whatsapp: "Test WhatsApp",
        check_low_stock: "Check Low Stock",
        check_expiry: "Check Expiry"
      },
      hi: {
        title: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï",
        heading: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï",
        subheading: "‡§≤‡§æ‡§á‡§µ ‡§∂‡•Ä‡§ü ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§µ‡§≤‡•ã‡§ï‡§®",
        lang_label: "‡§≠‡§æ‡§∑‡§æ:",
        description: "‡§Ø‡§π ‡§™‡•á‡§ú ‡§∂‡•Ä‡§ü ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à; ‡§è‡§Æ‡•ç‡§¨‡•á‡§° ‡§ï‡§ø‡§è ‡§ó‡§è ‡§µ‡•ç‡§Ø‡•Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§°‡•á‡§ü ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§",
        table_heading: "‡§∂‡•Ä‡§ü (‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶‡§ø‡§§)",
        table_sub: "‡§≤‡§æ‡§á‡§µ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§î‡§∞ ‡§Æ‡§∂‡•Ä‡§® ‡§∏‡•á ‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶‡§ø‡§§‡•§",
        refresh: "‡§§‡§æ‡§ú‡§º‡§æ ‡§ï‡§∞‡•á‡§Ç",
        translate_note: "‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶ ‡§Æ‡§∂‡•Ä‡§® ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à; ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§∏‡§Æ‡§Ø ‡§≤‡§ó ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡§π ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§"
      },
      bn: {
        title: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï",
        heading: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï",
        subheading: "‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∂‡ßÄ‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â",
        lang_label: "‡¶≠‡¶æ‡¶∑‡¶æ:",
        description: "‡¶è‡¶á ‡¶™‡¶æ‡¶§‡¶æ ‡¶∂‡ßÄ‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶Ø‡¶º; ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶≠‡¶ø‡¶â-‡¶§‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶´‡¶≤‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡•§",
        table_heading: "‡¶∂‡ßÄ‡¶ü (‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶‡¶ø‡¶§)",
        table_sub: "‡¶≤‡¶æ‡¶á‡¶≠‡¶≠‡¶æ‡¶¨‡ßá ‡¶´‡ßá‡¶ö ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶∂‡¶ø‡¶® ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶≤‡ßá‡¶ü‡ßá‡¶°‡•§",
        refresh: "‡¶§‡¶æ‡¶ú‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®",
        translate_note: "‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶Æ‡ßá‡¶∂‡¶ø‡¶®-‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡ßá‡¶°; ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶∏‡¶Æ‡ßü ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§"
      },
      te: {
        title: "‡∞Æ‡±Ä ‡∞∏‡±ç‡∞ü‡∞æ‡∞ï‡±ç",
        heading: "‡∞Æ‡±Ä ‡∞∏‡±ç‡∞ü‡∞æ‡∞ï‡±ç",
        subheading: "‡∞∏‡∞ú‡±Ä‡∞µ ‡∞∑‡±Ä‡∞ü‡±ç ‡∞™‡±ç‡∞∞‡∞ø‡∞µ‡±ç‡∞Ø‡±Ç",
        lang_label: "‡∞≠‡∞æ‡∞∑:",
        description: "‡∞à ‡∞™‡±á‡∞ú‡±Ä ‡∞∑‡±Ä‡∞ü‡±ç‚Äå‡∞®‡±Å ‡∞ö‡±Ç‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø; ‡∞é‡∞Ç‡∞¨‡±Ü‡∞°‡±ç ‡∞ö‡±á‡∞∏‡∞ø‡∞® ‡∞µ‡±Ä‡∞µ‡±Å‡∞≤‡±ã ‡∞®‡∞µ‡±Ä‡∞ï‡∞∞‡∞£‡∞≤‡±Å ‡∞Ü‡∞ü‡±ã‡∞Æ‡±á‡∞ü‡∞ø‡∞ï‡±ç‚Äå‡∞ó‡∞æ ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø.",
        table_heading: "‡∞∑‡±Ä‡∞ü‡±ç (‡∞Ö‡∞®‡±Å‡∞µ‡∞¶‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø)",
        table_sub: "‡∞ú‡±Ä‡∞µ‡∞Ç‡∞ó‡∞æ ‡∞´‡±Ü‡∞ö‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞Æ‡±Ü‡∞∑‡±Ä‡∞®‡±ç ‡∞Ö‡∞®‡±Å‡∞µ‡∞¶‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø.",
        refresh: "‡∞∞‡∞ø‡∞´‡±ç‡∞∞‡±Ü‡∞∑‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        translate_note: "‡∞Ö‡∞®‡±Å‡∞µ‡∞æ‡∞¶‡∞Ç ‡∞Æ‡±Ü‡∞∑‡±Ä‡∞®‡±ç ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø; ‡∞ï‡±ä‡∞¶‡±ç‡∞¶‡∞ø‡∞ó‡∞æ ‡∞∏‡∞Æ‡∞Ø‡∞Ç ‡∞™‡∞°‡∞µ‡∞ö‡±ç‡∞ö‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞™‡∞∞‡∞ø‡∞Æ‡∞ø‡∞§‡∞ø ‡∞â‡∞Ç‡∞°‡∞µ‡∞ö‡±ç‡∞ö‡±Å."
      },
      mr: {
        title: "‡§Ü‡§™‡§≤‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï",
        heading: "‡§Ü‡§™‡§≤‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï",
        subheading: "‡§ù‡§ø‡§µ‡§Ç‡§§ ‡§∂‡•Ä‡§ü ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§µ‡§≤‡•ã‡§ï‡§®",
        lang_label: "‡§≠‡§æ‡§∑‡§æ:",
        description: "‡§π‡§æ ‡§™‡•É‡§∑‡•ç‡§† ‡§∂‡•Ä‡§ü ‡§¶‡§æ‡§ñ‡§µ‡§§‡•ã; ‡§è‡§Æ‡•ç‡§¨‡•á‡§° ‡§ï‡•á‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§¶‡•É‡§∂‡•ç‡§Ø‡§æ‡§§ ‡§Ö‡§¶‡•ç‡§Ø‡§§‡§®‡•á ‡§Ü‡§™‡•ã‡§Ü‡§™ ‡§¶‡§ø‡§∏‡§§‡§æ‡§§.",
        table_heading: "‡§∂‡•Ä‡§ü (‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶‡§ø‡§§)",
        table_sub: "‡§≤‡§æ‡§á‡§µ‡•ç‡§π ‡§´‡•á‡§ö ‡§ï‡•á‡§≤‡•á‡§≤‡•á ‡§Ü‡§£‡§ø ‡§Æ‡§∂‡•Ä‡§®‡§®‡•á ‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶ ‡§ï‡•á‡§≤‡•á‡§≤‡•á.",
        refresh: "‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§§‡§æ‡§ú‡•á‡§§‡§µ‡§æ‡§®‡•á ‡§ï‡§∞‡§æ",
        translate_note: "‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶ ‡§Æ‡§∂‡•Ä‡§®‡§¶‡•ç‡§µ‡§æ‡§∞‡•á ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ü‡§≤‡§æ ‡§Ü‡§π‡•á; ‡§•‡•ã‡§°‡§æ ‡§µ‡•á‡§≥ ‡§≤‡§æ‡§ó‡•Ç ‡§∂‡§ï‡§§‡•ã ‡§Ü‡§£‡§ø ‡§Æ‡§∞‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§Ö‡§∏‡•Ç ‡§∂‡§ï‡§§‡§æ‡§§."
      },
      ta: {
        title: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ∏‡Øç‡Æü‡Ææ‡Æï‡Øç",
        heading: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ∏‡Øç‡Æü‡Ææ‡Æï‡Øç",
        subheading: "‡Æ®‡Øá‡Æ∞‡Æü‡Æø ‡Æ∑‡ØÄ‡Æü‡Øç ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øã‡Æü‡Øç‡Æü‡ÆÆ‡Øç",
        lang_label: "‡ÆÆ‡Øä‡Æ¥‡Æø:",
        description: "‡Æá‡Æ®‡Øç‡Æ§ ‡Æ™‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡Æ∑‡ØÄ‡Æü‡Øç‡Æü‡Øà ‡Æï‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ; ‡Æè‡ÆÆ‡Øç‡Æ™‡ØÜ‡Æü‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æï‡Ææ‡Æü‡Øç‡Æö‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Ææ‡Æü‡ØÅ‡Æï‡Æ≥‡Øç ‡Æ§‡Ææ‡Æ©‡Ææ‡Æï ‡Æ§‡ØÜ‡Æ∞‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç.",
        table_heading: "‡Æ∑‡ØÄ‡Æü‡Øç (‡ÆÆ‡Øä‡Æ¥‡Æø‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ)",
        table_sub: "‡Æ®‡Øá‡Æ∞‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡Æ™‡ØÜ‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÜ‡Æ∑‡Æø‡Æ©‡Øç ‡ÆÆ‡Øä‡Æ¥‡Æø‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
        refresh: "‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï",
        translate_note: "‡ÆÆ‡Øä‡Æ¥‡Æø‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡ØÜ‡Æ∑‡Æø‡Æ©‡Øç ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æø‡ÆØ‡Æ§‡ØÅ; ‡Æö‡Æø‡Æ≤ ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç ‡Æé‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æ∞‡ÆÆ‡Øç‡Æ™‡ØÅ ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç."
      },
      gu: {
        title: "‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™∏‡´ç‡™ü‡´ã‡™ï",
        heading: "‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™∏‡´ç‡™ü‡´ã‡™ï",
        subheading: "‡™≤‡™æ‡™á‡™µ ‡™∂‡´Ä‡™ü ‡™™‡´Ç‡™∞‡´ç‡™µ‡™æ‡™µ‡™≤‡´ã‡™ï‡™®",
        lang_label: "‡™≠‡™æ‡™∑‡™æ:",
        description: "‡™Ü ‡™™‡´á‡™ú ‡™∂‡´Ä‡™ü ‡™¨‡™§‡™æ‡™µ‡´á ‡™õ‡´á; ‡™è‡™Æ‡´ç‡™¨‡´á‡™° ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ü‡™µ‡´á‡™≤‡™æ ‡™µ‡´ç‡™Ø‡´Ç‡™Æ‡™æ‡™Ç ‡™Ö‡™™‡™°‡´á‡™ü‡´ç‡™∏ ‡™Ü‡™™‡™Æ‡´á‡™≥‡´á ‡™¶‡´á‡™ñ‡™æ‡™Ø ‡™õ‡´á.",
        table_heading: "‡™∂‡´Ä‡™ü (‡™Ö‡™®uvad‡™ø‡™§)",
        table_sub: "‡™≤‡™æ‡™á‡™µ ‡™∞‡´Ä‡™§‡´á ‡™≤‡™æ‡™à ‡™ó‡™Ø‡´á‡™≤ ‡™Ö‡™®‡´á ‡™Æ‡™∂‡´Ä‡™®‡™•‡´Ä ‡™Ö‡™®‡´Å‡™µ‡™æ‡™¶‡™ø‡™§.",
        refresh: "‡™∞‡´Ä‡™´‡´ç‡™∞‡´á‡™∂ ‡™ï‡™∞‡´ã",
        translate_note: "‡™Ö‡™®‡´Å‡™µ‡™æ‡™¶ ‡™Æ‡™∂‡´Ä‡™® ‡™¶‡´ç‡™µ‡™æ‡™∞‡™æ ‡™¨‡™®‡™æ‡™µ‡™æ‡™Ø‡´á‡™≤‡´ã ‡™õ‡´á; ‡™•‡´ã‡™°‡´ã ‡™∏‡™Æ‡™Ø ‡™≤‡™æ‡™ó‡´Ä ‡™∂‡™ï‡´á ‡™õ‡´á ‡™Ö‡™®‡´á ‡™Æ‡™∞‡´ç‡™Ø‡™æ‡™¶‡™ø‡™§ ‡™•‡™à ‡™∂‡™ï‡´á ‡™õ‡´á."
      },
      kn: {
        title: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∏‡≥ç‡≤ü‡≤æ‡≤ï‡≥ç",
        heading: "‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∏‡≥ç‡≤ü‡≤æ‡≤ï‡≥ç",
        subheading: "‡≤ú‡≥à‡≤µ ‡≤∂‡≥Ä‡≤ü‡≥ç ‡≤™‡≥Ç‡≤∞‡≥ç‡≤µ‡≤¶‡≥É‡≤∂‡≥ç‡≤Ø",
        lang_label: "‡≤≠‡≤æ‡≤∑‡≥Ü:",
        description: "‡≤à ‡≤™‡≥Å‡≤ü‡≤µ‡≥Å ‡≤∂‡≥Ä‡≤ü‡≥ç ‡≤Ö‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥ã‡≤∞‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü; ‡≤é‡≤Ç‡≤¨‡≥Ü‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶ ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤£‡≥Ü‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≤µ‡≥Ä‡≤ï‡≤∞‡≤£‡≤ó‡≤≥‡≥Å ‡≤∏‡≥ç‡≤µ‡≤Ø‡≤Ç‡≤ö‡≤æ‡≤≤‡≤ø‡≤§‡≤µ‡≤æ‡≤ó‡≤ø ‡≤ï‡≤æ‡≤£‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤µ‡≥Ü.",
        table_heading: "‡≤∂‡≥Ä‡≤ü‡≥ç (‡≤Ö‡≤®‡≥Å‡≤µ‡≤æ‡≤¶‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü)",
        table_sub: "‡≤≤‡≥à‡≤µ‡≥ç‚Äå‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤´‡≥Ü‡≤ö‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤Ö‡≤®‡≥Å‡≤µ‡≤æ‡≤¶‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.",
        refresh: "‡≤®‡≤µ‡≥Ä‡≤ï‡≤∞‡≤ø‡≤∏‡≤ø",
        translate_note: "‡≤Ö‡≤®‡≥Å‡≤µ‡≤æ‡≤¶‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤µ‡≥Å ‡≤∞‡≤ö‡≤ø‡≤∏‡≤ø‡≤¶‡≥Ü; ‡≤∏‡≥ç‡≤µ‡≤≤‡≥ç‡≤™ ‡≤∏‡≤Æ‡≤Ø ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤¨‡≤π‡≥Å‡≤¶‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≤ø‡≤§‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø‡≤∞‡≤¨‡≤π‡≥Å‡≤¶‡≥Å."
      },
      or: {
        title: "‡¨Ü‡¨™‡¨£‡¨ô‡≠ç‡¨ï‡¨∞ ‡¨∑‡≠ç‡¨ü‡¨ï‡≠ç",
        heading: "‡¨Ü‡¨™‡¨£‡¨ô‡≠ç‡¨ï‡¨∞ ‡¨∑‡≠ç‡¨ü‡¨ï‡≠ç",
        subheading: "‡¨∏‡¨ú‡≠Ä‡¨¨ ‡¨∂‡¨ø‡¨ü‡≠ç ‡¨™‡≠Ç‡¨∞‡≠ç‡¨¨‡¨¶‡≠É‡¨∂‡≠ç‡≠ü",
        lang_label: "‡¨≠‡¨æ‡¨∑‡¨æ:",
        description: "‡¨è‡¨π‡¨ø ‡¨™‡≠É‡¨∑‡≠ç‡¨†‡¨æ ‡¨∂‡¨ø‡¨ü‡≠ç ‡¨¶‡¨∞‡≠ç‡¨∂‡¨æ‡¨è; ‡¨è‡¨Æ‡≠ç‡¨¨‡≠á‡¨°‡≠ç ‡¨π‡≠ã‡¨á‡¨•‡¨ø‡¨¨‡¨æ ‡¨≠‡≠ç‡≠ü‡≠Å‡¨∞‡≠á ‡¨Ö‡¨¶‡≠ç‡≠ü‡¨§‡¨® ‡¨Ü‡¨™‡≠ã‡¨Ü‡¨™‡¨ø ‡¨™‡≠ç‡¨∞‡¨¶‡¨∞‡≠ç‡¨∂‡¨ø‡¨§ ‡¨π‡≠Å‡¨è‡•§",
        table_heading: "‡¨∂‡¨ø‡¨ü‡≠ç (‡¨Ö‡¨®‡≠Å‡¨¨‡¨æ‡¨¶‡¨ø‡¨§)",
        table_sub: "‡¨∏‡¨ú‡≠Ä‡¨¨ ‡¨≠‡¨æ‡¨¨‡¨∞‡≠á ‡¨´‡≠á‡¨ö‡≠ç ‡¨π‡≠ã‡¨á‡¨õ‡¨ø ‡¨è‡¨¨‡¨Ç ‡¨Æ‡≠á‡¨∏‡¨ø‡¨®‡≠ç ‡¨¶‡≠ç‡≠±‡¨æ‡¨∞‡¨æ ‡¨Ö‡¨®‡≠Å‡¨¨‡¨æ‡¨¶‡¨ø‡¨§‡•§",
        refresh: "‡¨§‡¨æ‡¨ú‡¨æ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å",
        translate_note: "‡¨Ö‡¨®‡≠Å‡¨¨‡¨æ‡¨¶ ‡¨Æ‡≠á‡¨∏‡¨ø‡¨®‡≠ç ‡¨¶‡≠ç‡≠±‡¨æ‡¨∞‡¨æ ‡¨§‡¨ø‡¨Ü‡¨∞‡¨ø; ‡¨ï‡¨ø‡¨õ‡¨ø ‡¨∏‡¨Æ‡≠ü ‡¨≤‡¨æ‡¨ó‡¨ø‡¨™‡¨æ‡¨∞‡≠á ‡¨è‡¨¨‡¨Ç ‡¨∏‡≠Ä‡¨Æ‡¨ø‡¨§ ‡¨π‡≠ã‡¨á‡¨™‡¨æ‡¨∞‡≠á‡•§"
      },
      pa: {
        title: "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®∏‡®ü‡®æ‡®ï",
        heading: "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®∏‡®ü‡®æ‡®ï",
        subheading: "‡®≤‡®æ‡®à‡®µ ‡®∏‡©Ä‡®ü ‡®™‡©ç‡®∞‡©Ä‡®µ‡®ø‡®ä",
        lang_label: "‡®≠‡®æ‡®∏‡®º‡®æ:",
        description: "‡®á‡®π ‡®™‡©∞‡®®‡®æ ‡®∏‡©Ä‡®ü ‡®¶‡®ø‡®ñ‡®æ‡®â‡®Ç‡®¶‡®æ ‡®π‡©à; ‡®è‡©∞‡®¨‡©à‡®° ‡®ï‡©Ä‡®§‡©á ‡®¶‡©ç‡®∞‡®ø‡®∏‡®º ‡®µ‡®ø‡©±‡®ö ‡®Ö‡®™‡®°‡©á‡®ü ‡®Ü‡®ü‡©ã‡®Æ‡©à‡®ü‡®ø‡®ï ‡®§‡©å‡®∞ '‡®§‡©á ‡®¶‡®ø‡®ñ‡®æ‡®à ‡®¶‡©á ‡®∞‡®π‡©á ‡®π‡®®‡•§",
        table_heading: "‡®∏‡©Ä‡®ü (‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶‡®ø‡®§)",
        table_sub: "‡®≤‡®æ‡®à‡®µ ‡®§‡©å‡®∞ '‡®§‡©á ‡®´‡©à‡®ö ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à ‡®Ö‡®§‡©á ‡®Æ‡®∏‡®º‡©Ä‡®® ‡®¶‡©Å‡®Ü‡®∞‡®æ ‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶ ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à‡•§",
        refresh: "‡®§‡®æ‡®ú‡®º‡®æ ‡®ï‡®∞‡©ã",
        translate_note: "‡®Ö‡®®‡©Å‡®µ‡®æ‡®¶ ‡®Æ‡®∏‡®º‡©Ä‡®®-‡®ú‡®®‡®∞‡©á‡®ü‡®ø‡®° ‡®π‡©à; ‡®ï‡©Å‡®ù ‡®∏‡®Æ‡®æ‡®Ç ‡®≤‡©±‡®ó ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à ‡®Ö‡®§‡©á ‡®∏‡©Ä‡®Æ‡®ø‡®§ ‡®π‡©ã ‡®∏‡®ï‡®¶‡®æ ‡®π‡©à‡•§"
      },
      ml: {
        title: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡µç‡¥±‡µç‡¥±‡µã‡¥ï‡µç‡¥ï‡µç",
        heading: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡µç‡¥±‡µç‡¥±‡µã‡¥ï‡µç‡¥ï‡µç",
        subheading: "‡¥≤‡µà‡¥µ‡µç ‡¥∑‡µÄ‡¥±‡µç‡¥±‡µç ‡¥Æ‡µÅ‡µª‡¥ï‡µÇ‡µº ‡¥¶‡µÉ‡¥∂‡µç‡¥Ø‡¥Ç",
        lang_label: "‡¥≠‡¥æ‡¥∑:",
        description: "‡¥à ‡¥™‡µá‡¥ú‡µç ‡¥∑‡µÄ‡¥±‡µç‡¥±‡µç ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ; ‡¥é‡¥Æ‡µç‡¥™‡µÜ‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§ ‡¥¶‡µÉ‡¥∂‡µç‡¥Ø‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥Ö‡¥™‡µç‡¥°‡µá‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥∏‡µç‡¥µ‡¥Ø‡¥Ç ‡¥™‡µç‡¥∞‡¥§‡¥ø‡¥´‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.",
        table_heading: "‡¥∑‡µÄ‡¥±‡µç‡¥±‡µç (‡¥§‡µº‡¥ú‡µç‡¥Æ ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ)",
        table_sub: "‡¥≤‡µà‡¥µ‡µç ‡¥Ü‡¥Ø‡¥ø ‡¥´‡µÜ‡¥ö‡µç‡¥ö‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‡¥Æ‡µÜ‡¥∑‡µÄ‡µª ‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‚Äå‡¥≤‡µá‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥§‡µç.",
        refresh: "‡¥™‡¥∞‡µÅ‡¥§‡µç‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï",
        translate_note: "‡¥§‡µº‡¥ú‡µç‡¥Æ‡¥æ‡¥µ‡µç ‡¥Æ‡µÜ‡¥∑‡µÄ‡µª ‡¥®‡¥ø‡µº‡¥Æ‡µç‡¥Æ‡¥ø‡¥§‡¥Æ‡¥æ‡¥£‡µç; ‡¥ï‡µÅ‡¥±‡¥ö‡µç‡¥ö‡µç ‡¥∏‡¥Æ‡¥Ø‡¥Ç ‡¥é‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡¥æ‡¥Ç, ‡¥™‡¥∞‡¥ø‡¥ß‡¥ø ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡¥æ‡¥Ç."
      }
    };

    // mapping (LibreTranslate uses same codes for these)
    const langMap = {
      en: "en",
      hi: "hi",
      bn: "bn",
      te: "te",
      mr: "mr",
      ta: "ta",
      gu: "gu",
      kn: "kn",
      or: "or",
      pa: "pa",
      ml: "ml"
    };

    let originalValues = null;

    async function fetchSheet() {
      // uses Sheets API; for public sheet you need an API key with Sheets API enabled.
      const url = `https://sheets.googleapis.com/v4/spreadsheets/1MussZ5RJ6yblFHQ6f-XyLsm6-_RHRBeLV7dr3NA66UU/values/Sheet1?key=AIzaSyDBI8DPGF_i5vQ90U1OQgbbDvQBj1tW3Nw`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Sheet fetch failed: " + res.statusText);
      const data = await res.json();
      return data.values || [];
    }

    async function translateText(text, targetLang) {
      if (!text) return "";
      if (targetLang === "en") return text;
      try {
        const resp = await fetch(TRANSLATE_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            q: text,
            source: "auto",
            target: targetLang,
            format: "text"
          })
        });
        const j = await resp.json();
        return j.translatedText || text;
      } catch (e) {
        console.warn("translate error", e);
        return text;
      }
    }

    async function renderTranslated(lang) {
      const target = langMap[lang] || "en";
      const container = document.getElementById("table-container");
      container.textContent = (translations[lang]?.table_sub) || "Translating...";
      if (!originalValues) {
        try {
          originalValues = await fetchSheet();
        } catch (e) {
          container.textContent = "Error fetching sheet: " + e.message;
          return;
        }
      }
      // translate every cell sequentially (could be optimized/batched)
      const translatedRows = [];
      for (let i = 0; i < originalValues.length; i++) {
        const row = originalValues[i];
        const translatedRow = await Promise.all(
          row.map(cell => translateText(cell, target))
        );
        translatedRows.push(translatedRow);
      }

      // build table
      const table = document.createElement("table");
      // header
      const headerRow = document.createElement("tr");
      (translatedRows[0] || []).forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);
      // body
      for (let i = 1; i < translatedRows.length; i++) {
        const tr = document.createElement("tr");
        translatedRows[i].forEach(c => {
          const td = document.createElement("td");
          td.textContent = c;
          tr.appendChild(td);
        });
        table.appendChild(tr);
      }

      container.innerHTML = "";
      container.appendChild(table);
    }

    function applyLang(lang) {
      const dict = translations[lang] || translations.en;
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (!dict[key]) return;
        if (el.tagName.toLowerCase() === "title") {
          document.title = dict[key];
        }
        el.textContent = dict[key];
      });
      localStorage.setItem("lang", lang);
      document.getElementById("lang").value = lang;
      // trigger translated sheet update
      renderTranslated(lang);
    }

    function initLang() {
      const params = new URLSearchParams(window.location.search);
      let lang = params.get("lang") || localStorage.getItem("lang") || (navigator.language || "en").slice(0,2);
      if (!Object.keys(langMap).includes(lang)) lang = "en";
      applyLang(lang);
    }

    document.getElementById("lang").addEventListener("change", e => {
      applyLang(e.target.value);
      const u = new URL(window.location);
      u.searchParams.set("lang", e.target.value);
      history.replaceState(null, "", u);
    });

    document.getElementById("refresh").addEventListener("click", () => {
      originalValues = null;
      const lang = document.getElementById("lang").value;
      renderTranslated(lang);
    });

    // initialize on load
    initLang();

    // ========================================
    // INVENTORY MANAGEMENT BUTTON HANDLERS
    // ========================================

    // Function to update status
    function updateInventoryStatus(message, isError = false) {
      const statusDiv = document.getElementById('inventory-status');
      statusDiv.textContent = message;
      statusDiv.style.background = isError ? '#fef2f2' : '#f0fdf4';
      statusDiv.style.color = isError ? '#dc2626' : '#166534';
    }

    // Run All Functions (like running excel.js)
    document.getElementById('run-all').addEventListener('click', async () => {
      try {
        console.log("\n" + "üöÄ".repeat(20));
        console.log("STARTING AUTOMATIC FUNCTION EXECUTION");
        console.log("üöÄ".repeat(20));

        // 1. Test Places API first
        updateInventoryStatus('üß™ Testing Places API...');
        console.log("\n" + "=".repeat(60));
        console.log("üß™ TESTING PLACES API");
        console.log("=".repeat(60));
        console.log('üîë Using API Key:', API_KEY ? API_KEY.substring(0, 10) + "..." : "None");
        const places = await testPlacesAPI(API_KEY);
        if (places) {
          const totalPlaces = places.gurudwaras.length + places.mandirs.length + places.ngos.length;
          updateInventoryStatus(`‚úÖ Places API test successful! Found ${totalPlaces} places total.`);
          console.log('üìä Places found:', {
            gurudwaras: places.gurudwaras.length,
            mandirs: places.mandirs.length,
            ngos: places.ngos.length
          });
        } else {
          updateInventoryStatus('‚ùå Places API test failed.', true);
        }
        
        // Wait a moment between tests
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 2. Test WhatsApp messaging with places
        updateInventoryStatus('üß™ Testing WhatsApp messaging with places...');
        console.log("\n" + "=".repeat(60));
        console.log("üß™ TESTING WHATSAPP MESSAGING WITH PLACES");
        console.log("=".repeat(60));
        await testExpiryWithPlaces(30);
        updateInventoryStatus('‚úÖ WhatsApp test message sent successfully!');
        
        // Wait a moment between tests
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 3. Run comprehensive inventory check
        updateInventoryStatus('üìä Running comprehensive inventory check...');
        console.log("\n" + "=".repeat(60));
        console.log("üìä RUNNING COMPREHENSIVE INVENTORY CHECK");
        console.log("=".repeat(60));
        const result = await checkInventoryAlerts(5, 30);
        
        console.log("\n" + "‚úÖ".repeat(20));
        console.log("ALL FUNCTIONS COMPLETED SUCCESSFULLY!");
        console.log("‚úÖ".repeat(20));
        
        updateInventoryStatus(`‚úÖ ALL FUNCTIONS COMPLETED! Found ${result.lowStock.length} low stock and ${result.expiring.length} expiring products.`);
        
      } catch (error) {
        console.error("\n‚ùå Error in automatic execution:", error);
        updateInventoryStatus(`‚ùå Error: ${error.message}`, true);
      }
    });

    // Check Inventory Alerts (Comprehensive)
    document.getElementById('check-inventory').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Checking inventory alerts...');
        console.log('üöÄ Starting comprehensive inventory check...');
        
        const result = await checkInventoryAlerts(5, 30);
        
        updateInventoryStatus(`‚úÖ Inventory check completed! Found ${result.lowStock.length} low stock and ${result.expiring.length} expiring products.`);
        
        console.log('üìä Inventory check results:', result);
      } catch (error) {
        console.error('‚ùå Error in inventory check:', error);
        updateInventoryStatus(`‚ùå Error: ${error.message}`, true);
      }
    });

    // Test Places API
    document.getElementById('test-places').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Testing Places API...');
        console.log('üß™ Testing Places API...');
        console.log('üîë Using API Key:', API_KEY ? API_KEY.substring(0, 10) + "..." : "None");
        
        // First test if we can access the Places API directly
        const testUrl = `https://maps.googleapis.com/maps/api/place/textsearch/json?query=gurudwara&location=28.4089,77.3178&radius=5000&key=${API_KEY}`;
        console.log('üåê Testing direct API access...');
        
        try {
          const testResponse = await fetch(testUrl);
          console.log('üì° API Response status:', testResponse.status);
          const testData = await testResponse.json();
          console.log('üì° API Response data:', testData);
          
          if (testData.status === 'REQUEST_DENIED') {
            updateInventoryStatus('‚ùå API Key is invalid or has restrictions', true);
            return;
          }
        } catch (apiError) {
          console.error('‚ùå Direct API test failed:', apiError);
          updateInventoryStatus('‚ùå Cannot access Places API (CORS issue)', true);
          return;
        }
        
        const places = await testPlacesAPI(API_KEY);
        
        if (places) {
          const totalPlaces = places.gurudwaras.length + places.mandirs.length + places.ngos.length;
          updateInventoryStatus(`‚úÖ Places API test successful! Found ${totalPlaces} places total.`);
          console.log('üìä Places found:', {
            gurudwaras: places.gurudwaras.length,
            mandirs: places.mandirs.length,
            ngos: places.ngos.length
          });
        } else {
          updateInventoryStatus('‚ùå Places API test failed.', true);
        }
      } catch (error) {
        console.error('‚ùå Error testing Places API:', error);
        updateInventoryStatus(`‚ùå Error: ${error.message}`, true);
      }
    });

    // Test WhatsApp Messaging
    document.getElementById('test-whatsapp').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Testing WhatsApp messaging...');
        console.log('üì± Testing WhatsApp messaging...');
        
        await testExpiryWithPlaces(30);
        
        updateInventoryStatus('‚úÖ WhatsApp test message sent successfully!');
      } catch (error) {
        console.error('‚ùå Error testing WhatsApp:', error);
        updateInventoryStatus(`‚ùå Error: ${error.message}`, true);
      }
    });

    // Check Low Stock Only
    document.getElementById('check-low-stock').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Checking low stock products...');
        console.log('üì¶ Checking low stock products...');
        
        const lowStockProducts = await triggerLowStockCheck(5);
        
        updateInventoryStatus(`‚úÖ Low stock check completed! Found ${lowStockProducts.length} products with low stock.`);
      } catch (error) {
        console.error('‚ùå Error checking low stock:', error);
        updateInventoryStatus(`‚ùå Error: ${error.message}`, true);
      }
    });

    // Check Expiry Only
    document.getElementById('check-expiry').addEventListener('click', async () => {
      try {
        updateInventoryStatus('Checking expiring products...');
        console.log('üìÖ Checking expiring products...');
        
        const expiringProducts = await triggerExpiryCheck(30);
        
        updateInventoryStatus(`‚úÖ Expiry check completed! Found ${expiringProducts.length} products nearing expiry.`);
      } catch (error) {
        console.error('‚ùå Error checking expiry:', error);
        updateInventoryStatus(`‚ùå Error: ${error.message}`, true);
      }
    });
  </script>
</body>
</html>
